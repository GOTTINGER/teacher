<?php
!defined('IN_APP') && exit('ILLEGAL EXECUTION');
/**
 * @author  ryan <cumt.xiaochi@gmail.com>
 */
?>
<div class="row-fluid">
  <div class="span12">
    <form action="/search" class="form-search">
      <input type="hidden" name="type" value="teacher">
      <input type="text" name="q" class="search-query" placeholder="输入老师的名字，搜索老师">
      <button type="submit" class="btn">搜索老师</button>
    </form>
  </div>
</div>

<div class="row-fluid">
  <div class="span4">
    <div>所有老师列在此处</div>
    <ul>
      <?php foreach ($recentTeachers as $t): ?>
        <li>
          <a href="<?php echo ROOT,"teacher/$t->id" ?>"><?php echo $t->name ?></a>
          <a href="<?php echo ROOT,"search?school=$t->school" ?>"><?php echo $t->school() ?></a>
        </li>
      <?php endforeach ?>
    </ul>
  </div>
  <div class="span4">
    <?php if (isset($timelines)): ?>
      <div>和你有关的动态</div>
      <ul>
        <?php foreach ($timelines as $t): ?>
          <li>
            <?php $act = $t->activity(); ?>
            <?php $user = $act->user(); ?>
            <?php if ($act->action === 'hate'): ?>
              <span>有人</span>
            <?php else: ?>
              <a href="<?php echo ROOT,'user/',$user->id ?>"><?php echo $user->name ?></a>
            <?php endif ?>
            <?php if ($act->action === 'comment'): ?>
              <span>评论了老师</span>
              <?php $teacher = new Teacher($act->object); ?>
              <a href="<?php echo ROOT,'teacher/',$teacher->id ?>"><?php echo $teacher->name ?></a>
              <?php $comment = new Comment($act->link); ?>
              <a href="<?php echo ROOT,'teacher/',$teacher->id,'/comment/',$comment->id ?>">查看</a>
            <?php elseif ($act->action === 'discuss'): ?>
              <?php $comment = new Comment($act->object); ?>
              <?php $teacher = $comment->teacher(); ?>
              <span>评论了你对<a href="<?php echo ROOT,'teacher/',$teacher->id ?>"><?php echo $teacher->name ?></a>老师的评论</span>
              <a href="<?php echo ROOT,'teacher/',$teacher->id,'/comment/',$comment->id ?>">查看</a>
            <?php elseif ($act->action === 'like'): ?>
              <?php $comment = new Comment($act->object); ?>
              <?php $teacher = $comment->teacher(); ?>
              <span>喜欢了你对<a href="<?php echo ROOT,'teacher/',$teacher->id ?>"><?php echo $teacher->name ?></a>老师的评论</span>
              <a href="<?php echo ROOT,'teacher/',$teacher->id,'/comment/',$comment->id ?>">查看</a>
            <?php elseif ($act->action === 'hate'): ?>
              <?php $comment = new Comment($act->object); ?>
              <?php $teacher = $comment->teacher(); ?>
              <span>反对了你对<a href="<?php echo ROOT,'teacher/',$teacher->id ?>"><?php echo $teacher->name ?></a>老师的评论</span>
              <a href="<?php echo ROOT,'teacher/',$teacher->id,'/comment/',$comment->id ?>">查看</a>
            <?php endif ?>
            <span><?php echo $act->created ?></span>
          </li>
        <?php endforeach ?>
      </ul>
    <?php endif ?>
  </div>
  <div class="span4">
    <div>最新评论</div>
    <ul>
      <?php foreach ($recentComments as $c): ?>
        <li>
          <?php $user = $c->user(); ?>
          <?php $teacher = $c->teacher(); ?>
          <a href="<?php echo ROOT,'user/',$user->id ?>"><?php echo $user->name ?></a>
          <span>评论了</span>
          <a href="<?php echo ROOT,'teacher/',$teacher->id ?>"><?php echo $teacher->name ?></a>
          <span>老师</span>
          <a href="<?php echo ROOT,'teacher/',$teacher->id,'/comment/',$c->id ?>">查看</a>
        </li>
      <?php endforeach ?>
    </ul>
  </div>
</div>

